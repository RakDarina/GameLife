<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
    <title>GameLife</title>
    <style>
    :root { --blue: #5856D6; --bg: #F8F9FB; --gray: #999999; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, system-ui, sans-serif; margin: 0; background: var(--bg); color: #1C1C1E; }
    
    /* Исправленная верхняя панель */
    .top-nav { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 60px 25px 20px;
    }
    
    /* Обертка для года, чтобы он не сжимался */
    .year-container {
        display: flex;
        align-items: center;
        flex: 1;
    }

    .year-input { 
        font-size: 32px; 
        font-weight: 800; 
        border: none; 
        background: transparent; 
        width: 120px; /* Увеличено со 100px, чтобы не обрезалось */
        outline: none; 
        color: #1C1C1E;
        padding: 0;
    }

    .settings-btn { 
        color: var(--gray);
        cursor: pointer;
        transition: 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5px;
    }
    .settings-btn:active { transform: rotate(30deg); color: var(--blue); }

    #app-viewport { padding: 0 20px 140px; min-height: 80vh; }

    .tab-bar { 
        position: fixed; bottom: 0; width: 100%; height: 90px; 
        background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); 
        border-top: 0.5px solid #E5E5EA; display: flex; 
        justify-content: space-around; padding-top: 12px; z-index: 1000; 
    }
    .tab-item { text-align: center; color: var(--gray); font-size: 10px; flex: 1; cursor: pointer; }
    .tab-item.active { color: var(--blue); }
    
    .material-icons-outlined { 
        display: block; 
        font-size: 26px; 
        margin-bottom: 4px; 
    }

        /* Стили для контейнера кнопок в шапке */
    .top-btns { display: flex; align-items: center; gap: 15px; }
    
    .todo-icon-btn {
        width: 28px;
        height: 28px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
    }
    .todo-icon-btn img { width: 100%; height: 100%; object-fit: contain; }
    .todo-icon-btn:active { transform: scale(0.9); }
        
</style>
</head>
<body>
    
   <div class="top-nav">
        <div class="year-container">
            <input type="number" id="app-year" value="2026" oninput="saveYear()" class="year-input">
        </div>
        <div class="top-btns">
            <div class="todo-icon-btn" onclick="loadModule('./todo_daily.js')">
                <img src="icon2.png" alt="Tasks">
            </div>
            <div class="settings-btn" onclick="loadModule('./settings.js')">
                <span class="material-icons-outlined">settings</span>
            </div>
        </div>
    </div>

    <div id="app-viewport"></div>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="loadModule('./goals.js', this)">
            <span class="material-icons-outlined">flag</span>
            <div>Цели</div>
        </div>
        
        <div class="tab-item" onclick="loadModule('./health.js', this)">
            <span class="material-icons-outlined">favorite_border</span>
            <div>Здоровье</div>
        </div>

        <div class="tab-item" onclick="loadModule('./mental.js', this)">
            <span class="material-icons-outlined">psychology</span>
            <div>Менталка</div>
        </div>

        <div class="tab-item" onclick="loadModule('./lists.js', this)">
            <span class="material-icons-outlined">format_list_bulleted</span>
            <div>Списки</div>
        </div>
    </nav>

    <script type="module">
        // (Твой скрипт загрузки остается таким же, он работает правильно)
        window.saveYear = function() {
            const yearValue = document.getElementById('app-year').value;
            localStorage.setItem('GL_Selected_Year', yearValue);
        };

        function loadYear() {
            const savedYear = localStorage.getItem('GL_Selected_Year');
            if (savedYear) document.getElementById('app-year').value = savedYear;
        }

        window.loadModule = async function(path, el) {
            if (el) {
                document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
            }
            try {
                const module = await import(path + '?v=' + Date.now());
                if (module.render) module.render(); 
            } catch (err) {
                console.error(err);
                document.getElementById('app-viewport').innerHTML = `<h1>Файл не найден</h1>`;
            }
        }

        window.onload = () => {
            loadYear();
            loadModule('./goals.js', document.querySelector('.tab-item')); 
        };
    </script>
</body>
</html>
