<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon.png">
    <title>GameLife</title>
    <style>
        :root { --blue: #007AFF; --bg: #F2F2F7; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, system-ui, sans-serif; margin: 0; background: var(--bg); color: #000; }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        #app-viewport { padding: 20px; padding-bottom: 180px; min-height: 100vh; }

        /* –¢–∞–±-–±–∞—Ä */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-top: 0.5px solid #C6C6C8; display: flex; justify-content: space-around; padding-top: 10px; z-index: 1000; }
        .tab-item { text-align: center; color: #8E8E93; font-size: 10px; flex: 1; cursor: pointer; }
        .tab-item.active { color: var(--blue); }
        .tab-icon { font-size: 24px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>
    
    <div style="padding: 50px 20px 0; background: var(--bg);">
        <div style="display: flex; align-items: center; gap: 10px;">
            <input type="number" id="app-year" value="2026" oninput="saveYear()" 
                style="font-size: 34px; font-weight: 800; border: none; background: transparent; width: 120px; outline: none;">
            <span style="font-size: 24px;">‚úèÔ∏è</span>
        </div>
    </div>

    <div id="app-viewport">
        </div>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="loadModule('./goals.js', this)"><span class="tab-icon">üéØ</span>–¶–µ–ª–∏</div>
        <div class="tab-item" onclick="loadModule('./mental.js', this)"><span class="tab-icon">üß†</span>–ú–µ–Ω—Ç–∞–ª–∫–∞</div>
        <div class="tab-item" onclick="loadModule('./lists.js', this)"><span class="tab-icon">üìö</span>–°–ø–∏—Å–∫–∏</div>
        <div class="tab-item" onclick="loadModule('./settings.js', this)"><span class="tab-icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    </nav>

    <script type="module">
    // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ–¥ –≤ –ø–∞–º—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    window.saveYear = function() {
        const yearValue = document.getElementById('app-year').value;
        localStorage.setItem('GL_Selected_Year', yearValue);
    };

    // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ–¥ –∏–∑ –ø–∞–º—è—Ç–∏
    function loadYear() {
        const savedYear = localStorage.getItem('GL_Selected_Year');
        if (savedYear) {
            document.getElementById('app-year').value = savedYear;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π (—Ç–≤–æ—è —Ç–µ–∫—É—â–∞—è)
    window.loadModule = async function(path, el) {
        if (el) {
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }
        try {
            const module = await import(path + '?v=' + Date.now());
            if (module.render) {
                module.render(); 
            }
        } catch (err) {
            console.error("–û—à–∏–±–∫–∞:", err);
            document.getElementById('app-viewport').innerHTML = `<h1>–£–ø—Å!</h1><p>–§–∞–π–ª ${path} –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>`;
        }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = () => {
        loadYear(); // –°–Ω–∞—á–∞–ª–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–æ–¥
        loadModule('./goals.js'); // –ü–æ—Ç–æ–º —Ä–∏—Å—É–µ–º —Ü–µ–ª–∏
    };
</script>
</body>
</html>
